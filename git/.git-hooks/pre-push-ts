#!/bin/bash
# TypeScript/JavaScript pre-push hook
# Runs type checking and linting before push

echo "Running pre-push checks..."

# Check if this is a TypeScript project
if [ ! -f "tsconfig.json" ]; then
    # Not a TypeScript project, skip checks
    exit 0
fi

# Check if node_modules exists
if [ ! -d "node_modules" ]; then
    echo "Error: node_modules not found. Run 'npm install' first."
    exit 1
fi

# Type checking
echo "  → Type checking with tsc..."
if ! npm run type-check &> /tmp/tsc-output.txt; then
    echo ""
    echo "╔════════════════════════════════════════════════════════╗"
    echo "║   TYPE ERRORS DETECTED!                               ║"
    echo "╚════════════════════════════════════════════════════════╝"
    echo ""
    cat /tmp/tsc-output.txt
    echo ""
    echo "Fix type errors before pushing."
    echo ""
    echo "To bypass (not recommended):"
    echo "  git push --no-verify"
    echo ""
    exit 1
fi
echo "  ✓ Type checking passed"

# Linting
echo "  → Linting with ESLint..."
if ! npm run lint &> /tmp/eslint-output.txt; then
    echo ""
    echo "╔════════════════════════════════════════════════════════╗"
    echo "║   LINT ERRORS DETECTED!                               ║"
    echo "╚════════════════════════════════════════════════════════╝"
    echo ""
    cat /tmp/eslint-output.txt
    echo ""
    echo "Fix lint errors before pushing."
    echo ""
    echo "Some errors may be auto-fixable:"
    echo "  npm run lint -- --fix"
    echo ""
    echo "To bypass (not recommended):"
    echo "  git push --no-verify"
    echo ""
    exit 1
fi
echo "  ✓ Linting passed"

echo ""
echo "✓ All pre-push checks passed. Proceeding with push..."
exit 0
